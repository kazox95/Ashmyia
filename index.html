<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CMG-GPT</title>

<style>
:root{
  --bg:#07070c;
  --surface:#0e0e16;
  --surface-soft:#141422;
  --border:#1f1f33;
  --text:#f4f4f5;
  --muted:#a1a1b3;
  --accent:#8b8bff;
  --accent-glow:0 0 40px rgba(139,139,255,.35);
  --radius:18px;
}

*{box-sizing:border-box;font-family:Inter,system-ui}

body{
  margin:0;
  background:
    radial-gradient(1200px 500px at 50% -200px,#1b1b3a,transparent),
    var(--bg);
  color:var(--text);
  height:100vh;
  display:flex;
  justify-content:center;
}

.app{
  width:100%;
  max-width:960px;
  display:flex;
  flex-direction:column;
}


header{
  height:70px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 28px;
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(8px);
}

header strong{
  font-size:1.05rem;
  letter-spacing:.4px;
}

.status{
  font-size:.7rem;
  padding:6px 12px;
  border-radius:999px;
  font-weight:600;
}
.online{background:#16a34a}
.offline{background:#dc2626}


.chat{
  flex:1;
  padding:56px 24px;
  overflow-y:auto;
}

.user{
  max-width:70%;
  margin-left:auto;
  background:linear-gradient(145deg,#1c1c2e,#141424);
  padding:14px 18px;
  border-radius:14px;
  margin-bottom:32px;
}


.bot{
  max-width:760px;
  margin:0 auto 64px;
  background:linear-gradient(180deg,var(--surface),#0a0a14);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:36px;
  box-shadow:0 30px 80px rgba(0,0,0,.5);
  animation:fadeUp .4s ease;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:none}
}


.bot h2{
  font-size:1.6rem;
  margin-bottom:18px;
}
.bot h3{
  margin:30px 0 12px;
  font-size:1.15rem;
}
.bot p{
  line-height:1.8;
  color:var(--muted);
  margin-bottom:16px;
}
.bot strong{color:var(--text)}
.bot em{opacity:.9}


.code-panel{
  margin:28px 0;
  background:#05050b;
  border:1px solid var(--border);
  border-radius:14px;
  overflow:hidden;
  box-shadow:var(--accent-glow);
}

.code-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 14px;
  background:linear-gradient(180deg,#11112a,#0b0b18);
  border-bottom:1px solid var(--border);
  font-size:.75rem;
  color:var(--muted);
}

.code-header button{
  background:none;
  border:none;
  color:var(--accent);
  cursor:pointer;
  font-weight:600;
}

pre{
  margin:0;
  padding:18px;
  overflow:auto;
  font-size:.8rem;
  line-height:1.6;
  font-family:JetBrains Mono,monospace;
  color:#e5e7ff;
}


.input{
  padding:20px 24px;
  border-top:1px solid var(--border);
  display:flex;
  gap:12px;
}

textarea{
  flex:1;
  height:56px;
  resize:none;
  background:#0e0e18;
  border:1px solid var(--border);
  color:var(--text);
  border-radius:14px;
  padding:14px;
}

button{
  background:linear-gradient(135deg,var(--accent),#6b6bff);
  color:white;
  border:none;
  border-radius:14px;
  padding:0 26px;
  font-weight:600;
  cursor:pointer;
  box-shadow:var(--accent-glow);
}

.reset{
  background:transparent;
  box-shadow:none;
  border:1px solid var(--border);
  color:var(--muted);
}
</style>
</head>

<body>

<div class="app">

<header>
  <strong>CMG-GPT</strong>
  <div>
    <button class="reset" onclick="resetChat()">Effacer le Chat</button>
    <span id="status" class="status offline">Serveur en cours...</span>
  </div>
</header>

<div class="chat" id="chat"></div>

<div class="input">
  <textarea id="input" placeholder="Écris un message…"></textarea>
  <button onclick="send()">Envoyer</button>
</div>

</div>

<script>
const API="http://localhost:3000/api/v1/prediction/0b173114-c0a2-49e5-9d43-69613e5c8883";
const chat=document.getElementById("chat");
const input=document.getElementById("input");
const status=document.getElementById("status");

async function ping(){
  try{
    await fetch(API,{method:"POST"});
    status.textContent="Serveur En ligne";
    status.className="status online";
  }catch{
    status.textContent="Serveur éteint";
    status.className="status offline";
  }
}
ping();setInterval(ping,20000);


function renderAI(text){
 
  text=text.replace(/```([\s\S]*?)```/g,(m,code)=>{
    return `
    <div class="code-panel">
      <div class="code-header">
        <span>Code</span>
        <button onclick="navigator.clipboard.writeText(\`${code.replace(/`/g,"\\`")}\`)">Copier</button>
      </div>
      <pre>${code.replace(/</g,"&lt;")}</pre>
    </div>`;
  });

  return text.split("\n\n").map(p=>{
    if(/^##/.test(p)) return `<h2>${p.replace(/^##/,"")}</h2>`;
    if(/^###/.test(p)) return `<h3>${p.replace(/^###/,"")}</h3>`;
    return `<p>${p
      .replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>")
      .replace(/\*(.+?)\*/g,"<em>$1</em>")
    }</p>`;
  }).join("");
}

function typeWriter(el,text){
  let i=0,cur="";
  (function t(){
    if(i<text.length){
      cur+=text[i++];
      el.innerHTML=renderAI(cur);
      chat.scrollTop=chat.scrollHeight;
      setTimeout(t,10);
    }
  })();
}

async function send(){
  const t=input.value.trim();
  if(!t) return;
  input.value="";

  chat.innerHTML+=`<div class="user">${t}</div>`;
  const bot=document.createElement("div");
  bot.className="bot";
  chat.appendChild(bot);

  try{
    const r=await fetch(API,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({question:t})
    }).then(r=>r.json());

    typeWriter(bot,r.text);
  }catch{
    bot.innerHTML="<h2>Erreur</h2><p>Serveur indisponible.</p>";
  }
}

function resetChat(){
  chat.innerHTML="";
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&!e.shiftKey){
    e.preventDefault();send();
  }
});
</script>

</body>
</html>
